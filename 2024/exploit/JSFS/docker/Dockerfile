FROM oven/bun:1-slim AS base

ENV DEBIAN_FRONTEND noninteractive
RUN apt-get update && apt-get install -y xinetd && rm -rf /var/lib/apt/lists/*

RUN --mount=type=bind,source=jsfs.js,target=jsfs-src.js bun build --minify jsfs-src.js | fold -sw1024 > /jsfs.js
COPY ctf.xinetd /etc/xinetd.d/ctf

CMD ["/usr/sbin/xinetd", "-dontfork"]
